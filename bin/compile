#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

echo "--------> Install qpdf"
BUILD_DIR=$1

VENDOR_DIR="vendor"
SOURCE_DIR="$(dirname $0)/../compiled"

mkdir -p $VENDOR_DIR
tar zxvf "$SOURCE_DIR/qpdf_8.0.2.tar.gz" -C "$VENDOR_DIR"

rm "$SOURCE_DIR/qpdf_8.0.2.tar.gz"

echo "exporting PATH and LD_LIBRARY_PATH" | indent
PROFILE_PATH="$BUILD_DIR/.profile.d/qpdf.sh"
mkdir -p $(dirname $PROFILE_PATH)
echo 'export PATH="/app/vendor/qpdf/bin:$PATH"' >> $PROFILE_PATH
echo 'export LD_LIBRARY_PATH="/app/vendor/qpdf/lib:$LD_LIBRARY_PATH"' >> $PROFILE_PATH
